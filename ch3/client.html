<!DOCTYPE html>
<html lang="en">
   <head>
      <title>WebSocket Echo Demo</title>
      <meta charset="UTF-8" />
      <meta name="author" content="Metal Gabe" />
      <meta name="description" content="WebSocket Echo Demo" />
      <meta name="keywords" content="websocket" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <link rel="stylesheet" href="http://bit.ly/cdn-bootstrap-css" />
      <link rel="stylesheet" href="http://bit.ly/cdn-bootstrap-theme" />
      <script src="http://bit.ly/cdn-bootstrap-jq"></script>
      <script language="text/javascript">
         const ws = new WebSocket('ws://localhost:8121');
         // const nickname = '';

         ws.onopen = (event) => {
            console.log('Connection to server has been opened.');
         };

         function appendLog(nickname, message) {
            const messagesElement = document.getElementById('messages');
            const newMessagesElementItem = document.createElement('li');
            let prefaceLabel;

            if (nickname === '*') {
               prefaceLabel = `<span class="label label-info">*</span>`;
            } else {
               prefaceLabel = `<span class="label label-success">${nickname}</span>`;
            }

            const messageText = `<h2>${prefaceLabel}  ${message}</h2>`;
            newMessagesElementItem.innerHTML = messageText;
            messagesElement.append(newMessagesElementItem);
         }

         ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            const { id, message, nickname } = data;
            appendLog(nickname, message);
            console.log(`ID: ${id} = ${message}`);
         };

         ws.onclose = (event) => {
            appendLog('*', 'Connection closed');
            console.log('Connection closed');
         };

         function sendMessage() {
            const messageElement = document.getElementById('message');

            if (ws.readyState === WebSocket.OPEN) {
               ws.send(messageElement.value);
            }

            messageElement.value = '';
            messageElement.focus();
         }

         function disconnect() {
            ws.close();
         }
      </script>
   </head>

   <body lang="en">
      <div class="vertical-center">
         <div class="container">
            <h1>Outgoing Message</h1>
            <form
               action=""
               class=""
               id="chat_form"
               method="get"
               name=""
               onsubmit="sendMessage(); return false;"
               role="form"
            >
               <div class="form-group">
                  <input
                     autofocus
                     class="form-control"
                     id="message"
                     name="message"
                     placeholder="Type text to echo in here"
                     type="text"
                     value=""
                  />
               </div>
               <button
                  class="btn btn-primary"
                  id="send"
                  onclick="sendMessage();"
                  type="button"
               >
                  Send!
               </button>
            </form>
            <h1>Incoming Messages</h1>
            <ul
               style="
                  margin-top: 16px;
                  min-height: 36px;
                  outline: 1px solid blue;
               "
               id="messages"
            ></ul>
         </div>
      </div>

      <script src="http://bit.ly/cdn-bootstrap-minjs"></script>
   </body>
</html>
